{"version":3,"sources":["../../js/override/canvas.js"],"names":[],"mappings":";;;;;;;AAKA,CAAC,UAAU,MAAV,EAAkB;AACf,iBADe;;AAEf,QAAI,CAAC,MAAD,EAAS;AACT,eADS;KAAb;;AAIA,WAAO,MAAP,CAAc,SAAd,CAAwB,UAAxB,GAAqC,UAAU,EAAV,EAAc,OAAd,EAAuB;AACxD,oBAAY,UAAU,EAAV,CAAZ,CADwD;;AAGxD,aAAK,WAAL,CAAiB,EAAjB,EAAqB,OAArB,EAHwD;AAIxD,aAAK,gBAAL,GAJwD;AAKxD,aAAK,kBAAL,GALwD;;AAOxD,aAAK,YAAL,GAAoB,IAAI,OAAO,YAAP,CAAoB,IAAxB,CAApB,CAPwD;KAAvB,CANtB;;AAgBf,WAAO,MAAP,CAAc,SAAd,CAAwB,gBAAxB,GAA2C,YAAW;AAClD,aAAK,iBAAL,GAAyB,IAAzB,CADkD;AAElD,aAAK,cAAL,GAAsB,IAAtB,CAFkD;AAGlD,aAAK,mBAAL,GAHkD;AAIlD,aAAK,kBAAL,GAJkD;AAKlD,aAAK,mBAAL;;;;;AALkD,YAUlD,CAAK,mBAAL,GAVkD;;AAYlD,aAAK,gBAAL,GAAwB,OAAO,WAAP,IAAsB,IAAI,OAAO,WAAP,CAAmB,IAAvB,CAAtB,CAZ0B;;AAclD,aAAK,UAAL,GAdkD;KAAX,CAhB5B;;AAiCf,WAAO,MAAP,CAAc,SAAd,CAAwB,SAAxB,GAAoC,YAAY;AAC5C,YAAI,iBAAiB,KAAK,gBAAL;YAAuB,YAA5C,CAD4C;;AAG5C,YAAI,KAAK,UAAL,IAAmB,KAAK,SAAL,IAAkB,CAAC,KAAK,cAAL,EAAqB;AAC3D,iBAAK,YAAL,CAAkB,KAAK,UAAL,CAAlB,CAD2D;SAA/D;;AAIA,aAAK,YAAL,CAAkB,cAAlB,EAP4C;;AAS5C,aAAK,IAAL,CAAU,eAAV,EAT4C;;AAW5C,YAAI,KAAK,MAAL,EAAa;AACb,mBAAO,IAAP,CAAY,WAAZ,CAAwB,IAAxB,EAA8B,cAA9B,EADa;SAAjB;AAGA,aAAK,iBAAL,CAAuB,cAAvB,EAd4C;;AAgB5C,uBAAe,IAAf,GAhB4C;AAiB5C,uBAAe,KAAK,sBAAL,EAAf;;AAjB4C,sBAmB5C,CAAe,SAAf,CAAyB,KAAzB,CAA+B,cAA/B,EAA+C,KAAK,iBAAL,CAA/C,CAnB4C;AAoB5C,aAAK,cAAL,CAAoB,cAApB,EAAoC,YAApC,EApB4C;AAqB5C,aAAK,sBAAL,IAA+B,KAAK,cAAL,CAAoB,cAApB,EAAoC,CAAC,KAAK,cAAL,EAAD,CAApC,CAA/B,CArB4C;AAsB5C,uBAAe,OAAf,GAtB4C;;AAwB5C,YAAI,CAAC,KAAK,oBAAL,IAA6B,KAAK,WAAL,EAAkB;AAChD,iBAAK,YAAL,CAAkB,cAAlB,EADgD;SAApD;AAGA,YAAI,KAAK,MAAL,EAAa;AACb,2BAAe,OAAf,GADa;SAAjB;AAGA,aAAK,cAAL,CAAoB,cAApB,EA9B4C;AA+B5C,YAAI,KAAK,oBAAL,IAA6B,KAAK,WAAL,EAAkB;AAC/C,iBAAK,YAAL,CAAkB,cAAlB,EAD+C;SAAnD;;AAIA,aAAK,IAAL,CAAU,cAAV,EAnC4C;AAoC5C,eAAO,IAAP,CApC4C;KAAZ,CAjCrB;;AAwEf,WAAO,MAAP,CAAc,SAAd,CAAwB,KAAxB,GAAgC,YAAY;AACxC,aAAK,YAAL,CAAkB,WAAlB,GADwC;AAExC,aAAK,QAAL,CAAc,MAAd,GAAuB,CAAvB,CAFwC;AAGxC,YAAI,KAAK,kBAAL,EAAyB;AACzB,iBAAK,kBAAL,GADyB;SAA7B;AAGA,YAAI,KAAK,mBAAL,EAA0B;AAC1B,iBAAK,mBAAL,GAD0B;SAA9B;AAGA,aAAK,YAAL,CAAkB,KAAK,gBAAL,CAAlB,CATwC;AAUxC,YAAI,KAAK,UAAL,EAAiB;AACjB,iBAAK,YAAL,CAAkB,KAAK,UAAL,CAAlB,CADiB;SAArB;AAGA,aAAK,IAAL,CAAU,gBAAV,EAbwC;AAcxC,aAAK,SAAL,GAdwC;AAexC,eAAO,IAAP,CAfwC;KAAZ,CAxEjB;;AA0Ff,WAAO,MAAP,CAAc,SAAd,CAAwB,mBAAxB,GAA8C,YAAY;AACtD,aAAK,cAAL,GAAsB,KAAK,oBAAL,EAAtB;;;;AADsD,YAKtD,CAAK,SAAL,CAAe,WAAf,CAA2B,KAAK,cAAL,CAA3B,CALsD;;AAOtD,aAAK,gBAAL,CAAsB,KAAK,aAAL,EAAoB,KAAK,cAAL,CAA1C,CAPsD;AAQtD,aAAK,iBAAL,CAAuB,KAAK,cAAL,CAAvB,CARsD;AAStD,aAAK,cAAL,CAAoB,KAApB,CAA0B,aAA1B,GAA0C,MAA1C,CATsD;;AAWtD,aAAK,aAAL,GAAqB,KAAK,cAAL,CAAoB,UAApB,CAA+B,IAA/B,CAArB,CAXsD;KAAZ,CA1F/B;;AAwGf,WAAO,MAAP,CAAc,SAAd,CAAwB,yBAAxB,GAAoD,UAAU,CAAV,EAAa;AAC7D,YAAI,MAAM,OAAO,IAAP,CAAY,eAAZ,CAA4B,KAAK,iBAAL,CAAlC;YACA,UAAU,OAAO,IAAP,CAAY,cAAZ,CAA2B,KAAK,UAAL,CAAgB,CAAhB,EAAmB,IAAnB,CAA3B,EAAqD,GAArD,CAAV,CAFyD;AAG7D,YAAI,KAAK,mBAAL,EAA0B;AAC1B,iBAAK,gBAAL,CAAsB,WAAtB,CAAkC,OAAlC,EAD0B;SAA9B;AAGA,YAAI,KAAK,gBAAL,CAAsB,cAAtB,EAAsC;AACtC,iBAAK,gBAAL,CAAsB,YAAtB,CAAmC,OAAnC,EADsC;SAA1C;;AAIA,aAAK,SAAL,CAAe,KAAK,iBAAL,CAAf,CAV6D;AAW7D,aAAK,IAAL,CAAU,YAAV,EAAwB,EAAC,GAAG,CAAH,EAAzB,EAX6D;;AAa7D,YAAI,SAAS,KAAK,UAAL,CAAgB,CAAhB,CAAT,CAbyD;AAc7D,YAAI,OAAO,MAAP,KAAkB,WAAlB,EAA+B;AAC/B,mBAAO,IAAP,CAAY,WAAZ,EAAyB,EAAC,GAAG,CAAH,EAAM,QAAQ,MAAR,EAAhC,EAD+B;SAAnC;KAdgD,CAxGrC;;AA2Hf,WAAO,MAAP,CAAc,SAAd,CAAwB,mBAAxB,GAA8C,UAAU,KAAV,EAAiB,OAAjB,EAA0B;AACpE,YAAI,SAAS,IAAT,CADgE;AAEpE,aAAK,YAAL,CAAkB,KAAK,UAAL,CAAlB,CAFoE;AAGpE,gBAAQ,KAAR;AACI,iBAAK,QAAL;AACI,oBAAI,KAAK,gBAAL,IACG,KAAK,gBAAL,YAAiC,OAAO,WAAP,EAAoB;AACxD,yBAAK,gBAAL,CAAsB,UAAtB,CAAiC,OAAjC,EADwD;iBAD5D,MAGO;AACH,yBAAK,gBAAL,GAAwB,IAAI,OAAO,WAAP,CAAmB,IAAvB,EAA6B,OAA7B,CAAxB,CADG;iBAHP;AAMA,sBAPJ;AADJ,iBASS,UAAL;AACI,oBAAG,KAAK,aAAL,EAAoB;AACnB,4BAAQ,KAAR,GAAgB;AACZ,2BAAG,KAAK,aAAL,CAAmB,CAAnB;AACH,2BAAG,KAAK,aAAL,CAAmB,CAAnB;qBAFP,CADmB;iBAAvB;AAMA,oBAAI,KAAK,gBAAL,IACG,KAAK,gBAAL,YAAiC,OAAO,UAAP,EAAmB;AACvD,yBAAK,gBAAL,CAAsB,UAAtB,CAAiC,OAAjC,EADuD;iBAD3D,MAGO;AACH,yBAAK,gBAAL,GAAwB,IAAI,OAAO,UAAP,CAAkB,IAAtB,EAA4B,UAAU,KAAV,EAAiB;AACjE,+BAAO,aAAP,GAAuB;AACnB,+BAAG,MAAM,CAAN;AACH,+BAAG,MAAM,CAAN;yBAFP,CADiE;qBAAjB,EAKjD,OALqB,CAAxB,CADG;iBAHP;AAWA,oBAAG,KAAK,aAAL,EAAoB;AACnB,yBAAK,gBAAL,CAAsB,WAAtB,GADmB;iBAAvB;AAGA,sBArBJ;AATJ,iBA+BS,QAAL,CA/BJ;AAgCI;AACI,oBAAI,EAAE,KAAK,gBAAL,IACC,KAAK,gBAAL,YAAiC,OAAO,WAAP,CADpC,EACyD;AACzD,yBAAK,gBAAL,GAAwB,IAAI,OAAO,WAAP,CAAmB,MAAvB,CAAxB,CADyD;iBAD7D;AAIA,qBAAK,IAAI,IAAJ,IAAY,OAAjB,EAA0B;AACtB,wBAAI,QAAQ,cAAR,CAAuB,IAAvB,CAAJ,EAAkC;AAC9B,6BAAK,gBAAL,CAAsB,IAAtB,IAA8B,QAAQ,IAAR,CAA9B,CAD8B;qBAAlC;iBADJ;AArCR,SAHoE;KAA1B,CA3H/B;;AA2Kf,WAAO,MAAP,CAAc,SAAd,CAAwB,cAAxB,GAAyC,UAAU,IAAV,EAAgB;AACrD,YAAI,CAAC,KAAK,gBAAL,IAAyB,KAAK,aAAL,KAAuB,IAAvB,EAA6B;AACvD,mBADuD;SAA3D;;AAIA,aAAK,YAAL,CAAkB,KAAK,UAAL,CAAlB,CALqD;AAMrD,YAAI,IAAJ,EAAU;AACN,iBAAK,aAAL,GAAqB,IAArB,CADM;AAEN,iBAAK,aAAL,CAAmB,gBAAnB,CAAoC,UAApC,EAAgD,KAAK,WAAL,CAAhD,CAFM;SAAV,MAGO;AACH,iBAAK,aAAL,GAAqB,KAArB,CADG;AAEH,iBAAK,aAAL,CAAmB,mBAAnB,CAAuC,UAAvC,EAAmD,KAAK,WAAL,CAAnD,CAFG;SAHP;KANqC,CA3K1B;CAAlB,CAAD,CA0LG,MA1LH","file":"canvas.js","sourcesContent":["/**\n * Created by GreenDou on 16/4/7.\n * Canvas Class Override\n */\n\n(function (fabric) {\n    \"use strict\";\n    if (!fabric) {\n        return;\n    }\n\n    fabric.Canvas.prototype.initialize = function (el, options) {\n        options || (options = {});\n\n        this._initStatic(el, options);\n        this._initInteractive();\n        this._createCacheCanvas();\n\n        this.layerManager = new fabric.LayerManager(this);\n    };\n\n    fabric.Canvas.prototype._initInteractive = function() {\n        this._currentTransform = null;\n        this._groupSelector = null;\n        this._initWrapperElement();\n        this._createUpperCanvas();\n        this._initEventListeners();\n\n        //todo: fix it for iPad\n        //this._initRetinaScaling();\n\n        this._createCursorCanvas();\n\n        this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\n\n        this.calcOffset();\n    };\n\n    fabric.Canvas.prototype.renderAll = function () {\n        var canvasToDrawOn = this.contextContainer, objsToRender;\n\n        if (this.contextTop && this.selection && !this._groupSelector) {\n            this.clearContext(this.contextTop);\n        }\n\n        this.clearContext(canvasToDrawOn);\n\n        this.fire('before:render');\n\n        if (this.clipTo) {\n            fabric.util.clipContext(this, canvasToDrawOn);\n        }\n        this._renderBackground(canvasToDrawOn);\n\n        canvasToDrawOn.save();\n        objsToRender = this._chooseObjectsToRender();\n        //apply viewport transform once for all rendering process\n        canvasToDrawOn.transform.apply(canvasToDrawOn, this.viewportTransform);\n        this._renderObjects(canvasToDrawOn, objsToRender);\n        this.preserveObjectStacking || this._renderObjects(canvasToDrawOn, [this.getActiveGroup()]);\n        canvasToDrawOn.restore();\n\n        if (!this.controlsAboveOverlay && this.interactive) {\n            this.drawControls(canvasToDrawOn);\n        }\n        if (this.clipTo) {\n            canvasToDrawOn.restore();\n        }\n        this._renderOverlay(canvasToDrawOn);\n        if (this.controlsAboveOverlay && this.interactive) {\n            this.drawControls(canvasToDrawOn);\n        }\n\n        this.fire('after:render');\n        return this;\n    };\n\n    fabric.Canvas.prototype.clear = function () {\n        this.layerManager.clearLayers();\n        this._objects.length = 0;\n        if (this.discardActiveGroup) {\n            this.discardActiveGroup();\n        }\n        if (this.discardActiveObject) {\n            this.discardActiveObject();\n        }\n        this.clearContext(this.contextContainer);\n        if (this.contextTop) {\n            this.clearContext(this.contextTop);\n        }\n        this.fire('canvas:cleared');\n        this.renderAll();\n        return this;\n    };\n\n    fabric.Canvas.prototype._createCursorCanvas = function () {\n        this.cursorCanvasEl = this._createCanvasElement();\n        //this.cursorCanvasEl.setAttribute('width', this.width);\n        //this.cursorCanvasEl.setAttribute('height', this.height);\n\n        this.wrapperEl.appendChild(this.cursorCanvasEl);\n\n        this._copyCanvasStyle(this.lowerCanvasEl, this.cursorCanvasEl);\n        this._applyCanvasStyle(this.cursorCanvasEl);\n        this.cursorCanvasEl.style.pointerEvents = \"none\";\n\n        this.contextCursor = this.cursorCanvasEl.getContext('2d');\n    };\n\n    fabric.Canvas.prototype._onMouseMoveInDrawingMode = function (e) {\n        var ivt = fabric.util.invertTransform(this.viewportTransform),\n            pointer = fabric.util.transformPoint(this.getPointer(e, true), ivt);\n        if (this._isCurrentlyDrawing) {\n            this.freeDrawingBrush.onMouseMove(pointer);\n        }\n        if (this.freeDrawingBrush.cursorRenderer) {\n            this.freeDrawingBrush.cursorRender(pointer);\n        }\n\n        this.setCursor(this.freeDrawingCursor);\n        this.fire('mouse:move', {e: e});\n\n        var target = this.findTarget(e);\n        if (typeof target !== 'undefined') {\n            target.fire('mousemove', {e: e, target: target});\n        }\n    };\n\n    fabric.Canvas.prototype.setFreeDrawingBrush = function (brush, options) {\n        var myself = this;\n        this.clearContext(this.contextTop);\n        switch (brush) {\n            case 'eraser':\n                if (this.freeDrawingBrush\n                    && this.freeDrawingBrush instanceof fabric.EraserBrush) {\n                    this.freeDrawingBrush.setOptions(options);\n                } else {\n                    this.freeDrawingBrush = new fabric.EraserBrush(this, options);\n                }\n                break;\n            case 'rotation':\n                if(this.rotationPoint) {\n                    options.point = {\n                        x: this.rotationPoint.x,\n                        y: this.rotationPoint.y\n                    };\n                }\n                if (this.freeDrawingBrush\n                    && this.freeDrawingBrush instanceof fabric.PointBrush) {\n                    this.freeDrawingBrush.setOptions(options);\n                } else {\n                    this.freeDrawingBrush = new fabric.PointBrush(this, function (point) {\n                        myself.rotationPoint = {\n                            x: point.x,\n                            y: point.y\n                        }\n                    }, options);\n                }\n                if(this.rotationPoint) {\n                    this.freeDrawingBrush.renderPoint();\n                }\n                break;\n            case 'pencil':\n            default :\n                if (!(this.freeDrawingBrush\n                    && this.freeDrawingBrush instanceof fabric.PencilBrush)) {\n                    this.freeDrawingBrush = new fabric.PencilBrush(myself);\n                }\n                for (var prop in options) {\n                    if (options.hasOwnProperty(prop)) {\n                        this.freeDrawingBrush[prop] = options[prop];\n                    }\n                }\n        }\n    };\n\n    fabric.Canvas.prototype.setDrawingMode = function (flag) {\n        if (!this.freeDrawingBrush || this.isDrawingMode === flag) {\n            return;\n        }\n\n        this.clearContext(this.contextTop);\n        if (flag) {\n            this.isDrawingMode = true;\n            this.upperCanvasEl.addEventListener('mouseout', this._onMouseOut);\n        } else {\n            this.isDrawingMode = false;\n            this.upperCanvasEl.removeEventListener('mouseout', this._onMouseOut);\n        }\n    }\n\n})(fabric);\n"]}