{"version":3,"sources":["../js/trim-canvas.js"],"names":[],"mappings":"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","file":"trim-canvas.js","sourcesContent":["(function () {\n    window.trim_canvas = function (c) {\n        // open new window with trimmed image:\n        return getCanvas(c).canvas;\n    };\n\n    /**\n     * Trim with Position Info\n     * @param c Canvas Context\n     * @param {{x:number,y:number}} rc Rotation Center\n     * @returns {{canvas: *, left: null, top: null, rc: *}}\n     */\n    window.trimCanvasWithPosition = function (c, rc) {\n        \"use strict\";\n        var result = getCanvas(c, rc);\n        if(rc) {\n            rc.x = rc.x - result.bound.left;\n            rc.y = rc.y - result.bound.top;\n        }\n\n        // open new window with trimmed image:\n        return {\n            canvas: result.canvas,\n            left: result.bound.left,\n            top: result.bound.top,\n            rc: rc\n        };\n    };\n\n    function detectBounds(c, rc) {\n        var ctx = c.getContext('2d'),\n            pixels = ctx.getImageData(0, 0, c.width, c.height),\n            l = pixels.data.length,\n            i,\n            bound = {\n                top: null,\n                left: null,\n                right: null,\n                bottom: null\n            },\n            x, y;\n\n        for (i = 0; i < l; i += 4) {\n            if (pixels.data[i + 3] !== 0) {\n                x = (i / 4) % c.width;\n                y = ~~((i / 4) / c.width);\n\n                if (bound.top === null) {\n                    bound.top = y;\n                }\n\n                if (bound.left === null) {\n                    bound.left = x;\n                } else if (x < bound.left) {\n                    bound.left = x;\n                }\n\n                if (bound.right === null) {\n                    bound.right = x;\n                } else if (bound.right < x) {\n                    bound.right = x;\n                }\n\n                if (bound.bottom === null) {\n                    bound.bottom = y;\n                } else if (bound.bottom < y) {\n                    bound.bottom = y;\n                }\n            }\n        }\n\n        if(rc){\n            if (bound.top > rc.y) {\n                bound.top = rc.y;\n            }\n            if (bound.bottom < rc.y) {\n                bound.bottom = rc.y;\n            }\n            if (bound.left > rc.x) {\n                bound.left = rc.x;\n            }\n            if (bound.right < rc.x) {\n                bound.right = rc.x;\n            }\n        }\n\n        bound.top = Math.max(bound.top - 10, 0);\n        bound.bottom = Math.min(bound.bottom + 10, c.height);\n        bound.left = Math.max(bound.left - 10, 0);\n        bound.right = Math.min(bound.right + 10, c.width);\n\n        return bound;\n    }\n\n    function getCanvas (c, rc) {\n        \"use strict\";\n        var copy = document.createElement('canvas').getContext('2d');\n        var bound = detectBounds(c, rc);\n        var trimHeight = bound.bottom - bound.top,\n            trimWidth = bound.right - bound.left;\n\n        copy.imageSmoothingEnabled = false;\n        copy.canvas.width = trimWidth;\n        copy.canvas.height = trimHeight;\n        copy.drawImage(c, bound.left, bound.top, trimWidth, trimHeight,\n            0, 0, trimWidth, trimHeight);\n        return {\n            canvas: copy.canvas,\n            bound: bound\n        };\n    }\n\n})();\n"]}