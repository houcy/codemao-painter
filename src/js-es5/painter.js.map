{"version":3,"sources":["../js/painter.js"],"names":[],"mappings":"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","file":"painter.js","sourcesContent":["(() => {\n  window.Painter = {\n\n    init(w, h) {\n      const $painterContent = $('.painter-content');\n      const $painterCanvas = $('#painter-canvas');\n      const $painterContainer = $('#painter-container');\n      const canvas = new fabric.Canvas('painter-canvas');\n      const myself = this;\n      let width = w;\n      let height = h;\n      let curColor = '';\n\n      this.$btnPencil = $('.btn-pencil');\n      this.$btnPointer = $('.btn-pointer');\n\n      //  todo: use relative width&height!\n      if (!width) {\n        width = $painterContent.width() - $('.painter-left-buttons').width()\n          - $('.painter-right-buttons').width() - 46;\n        height = $painterContent.height() - $('.painter-properties').height() - 26;\n      }\n      this.width = width;\n      this.height = height;\n      $painterCanvas.attr('height', height);\n      $painterCanvas.attr('width', width);\n      this.canvas = canvas;\n      canvas.enableRetinaScaling = false;\n\n      $painterContainer.css('visibility', 'visible');\n      $painterContainer.hide();\n\n      //  init vue\n\n      this.vm = new Vue({\n        el: '#painter-container',\n        data: {\n          width: 10,\n          content: '添加文字后在这里修改',\n          type: 'object',\n          color: '',\n        },\n        watch: {\n          'content'(value) {\n            const object = canvas.getActiveObject();\n            if (!object) return;\n\n            object.set('text', value).setCoords();\n            canvas.renderAll();\n          },\n          'width'(v) {\n            const object = canvas.getActiveObject();\n            let styleName = 'strokeWidth';\n            let value = v;\n            value = parseInt(value, 10);\n            if (canvas.freeDrawingBrush) {\n              canvas.freeDrawingBrush.width = value || 15;\n            }\n            if (!object) return;\n\n            if (this.type === 'text') {\n              styleName = 'fontSize';\n            }\n            if (object.setSelectionStyles && object.isEditing) {\n              const style = {};\n              style[styleName] = value;\n              object.setSelectionStyles(style);\n              object.setCoords();\n            } else {\n              object[styleName] = value;\n            }\n\n            object.setCoords();\n            canvas.renderAll();\n          },\n          'color'() {\n            curColor = this.color;\n\n            canvas.freeDrawingBrush.color = curColor;\n\n            const activeObject = canvas.getActiveObject();\n            const activeGroup = canvas.getActiveGroup();\n\n            if (activeGroup) {\n              const objectsInGroup = activeGroup.getObjects();\n              canvas.discardActiveGroup();\n              objectsInGroup.forEach((object) => {\n                if (object.stroke) {\n                  object.setStroke(curColor);\n                } else {\n                  object.setColor(curColor);\n                }\n              });\n            } else if (activeObject) {\n              if (activeObject.stroke) {\n                activeObject.setStroke(curColor);\n              } else {\n                activeObject.setColor(curColor);\n              }\n            }\n            canvas.renderAll();\n          },\n        },\n      });\n\n      function updateScope() {\n        const object = canvas.getActiveObject();\n        if (!object) return;\n\n        myself.vm.content = object.text || '';\n        if (myself.vm.content !== '') {\n          myself.vm.type = 'text';\n          myself.vm.width = object.fontSize;\n        } else {\n          myself.vm.type = 'path';\n          if (canvas.freeDrawingBrush) {\n            myself.vm.width = object.strokeWidth;\n          }\n        }\n      }\n\n      canvas.on('object:selected', updateScope);\n\n      //  init colors\n      function initColors() {\n        //  let total = 255 * 255 * 255;\n        const colors = ['e3135c', 'cd0024', 'f1521e', 'fce932', 'f5a72e', '8b5430', 'bd0add',\n          '9016e8', '4b90e0', '437715', '85d036', 'bae98a', '000000', 'ffffff'];\n        //  for (let i = 0; i < total - 100; i += total / 40) {\n        //    i = parseInt(i);\n        //    let color = i.toString(16);\n        //    while (color.length < 6) {\n        //        color = '0' + color;\n        //    }\n        //    $('.painter-colors-wrap').append(template('template-colors', {color: '#' + color}));\n        //  }\n        for (let i = 0; i < colors.length; ++i) {\n          $('.painter-colors-wrap').append(template('template-colors', { color: `#${colors[i]}` }));\n        }\n      }\n\n      initColors();\n\n      $('.painter-btn').on('click', function () {\n        if (!$(this).hasClass('active')) {\n          $(this).parent().find('.painter-btn').removeClass('active');\n          $(this).addClass('active');\n          if ($(this).hasClass('painter-colors')) {\n            canvas.freeDrawingBrush.color = $(this).attr('data-value');\n            curColor = $(this).attr('data-value');\n            myself.vm.color = curColor;\n\n            const activeObject = canvas.getActiveObject();\n            const activeGroup = canvas.getActiveGroup();\n\n            if (activeGroup) {\n              const objectsInGroup = activeGroup.getObjects();\n              canvas.discardActiveGroup();\n              objectsInGroup.forEach((object) => {\n                if (object.stroke) {\n                  object.setStroke(curColor);\n                } else {\n                  activeObject.setColor(curColor);\n                }\n              });\n            } else if (activeObject) {\n              if (activeObject.stroke) {\n                activeObject.setStroke(curColor);\n              } else {\n                activeObject.setColor(curColor);\n              }\n            }\n            canvas.renderAll();\n          }\n        }\n      });\n      function addLine() {\n        canvas.add(new fabric.Line([50, 100, 200, 200], {\n          left: Math.random() * myself.width,\n          top: Math.random() * myself.height,\n          stroke: curColor,\n          strokeWidth: myself.vm.width,\n        }));\n      }\n\n      function addRect(rectWidth, rectHeight, x, y) {\n        const rect = new fabric.Rect({\n          top: y,\n          left: x,\n          width: rectWidth,\n          height: rectHeight,\n          fill: canvas.freeDrawingBrush.color,\n        });\n        canvas.add(rect);\n      }\n\n      function addCircle(radius, x, y) {\n        canvas.add(new fabric.Circle({\n          left: x,\n          top: y,\n          fill: canvas.freeDrawingBrush.color,\n          radius: 50,\n          //  opacity: 0.8\n        }));\n      }\n\n      function addTriangle(triWidth, triHeight, x, y) {\n        canvas.add(new fabric.Triangle({\n          left: x,\n          top: y,\n          fill: canvas.freeDrawingBrush.color,\n          width: triWidth,\n          height: triHeight,\n        }));\n      }\n\n      function addImage(path, x, y) {\n        fabric.Image.fromURL(path, (image) => {\n          image.set({\n            left: x || 0,\n            top: y || 0,\n            angle: 0,\n          }).scale(1).setCoords();\n          this.canvas.add(image);\n          this.canvas.renderAll();\n        });\n      }\n\n      this.addImage = addImage;\n\n      function addText(x, y) {\n        const text = '点我选中文字，在画布下方可以修改文字内容和样式哦~';\n\n        const textSample = new fabric.Text(text, {\n          left: x || canvas.getWidth() / 2,\n          top: y || canvas.getHeight() / 2,\n          fontFamily: 'Microsoft YaHei',\n          angle: 0,\n          fill: canvas.freeDrawingBrush.color,\n          scaleX: 1,\n          scaleY: 1,\n          fontWeight: '',\n          originX: 'left',\n          hasRotatingPoint: true,\n          centerTransform: true,\n        });\n\n        this.canvas.add(textSample);\n      }\n\n      function removeSelected() {\n        const activeObject = canvas.getActiveObject();\n        const activeGroup = canvas.getActiveGroup();\n\n        if (activeGroup) {\n          const objectsInGroup = activeGroup.getObjects();\n          canvas.discardActiveGroup();\n          objectsInGroup.forEach((object) => {\n            canvas.remove(object);\n          });\n        } else if (activeObject) {\n          canvas.remove(activeObject);\n        }\n      }\n\n      function cancelSelected() {\n        canvas.deactivateAll();\n        canvas.renderAll();\n        // canvas.discardActiveObject();\n      }\n\n      function initEvents() {\n        const $btnPencil = myself.$btnPencil;\n        const $btnEraser = $('.btn-eraser');\n        const $btnRotation = $('.btn-rotation');\n        $('.painter-colors:first-child').click();\n        $btnPencil.on('click', () => {\n          cancelSelected();\n          canvas.setFreeDrawingBrush('pencil', {\n            width: 15,\n            color: curColor,\n          });\n          canvas.setDrawingMode(true);\n          myself.vm.width = 15;\n          // canvas.freeDrawingBrush.width=10;\n          // canvas.freeDrawingBrush.color=curColor;\n        });\n        $btnEraser.on('click', () => {\n          cancelSelected();\n          canvas.setFreeDrawingBrush('eraser', {\n            width: 15,\n            color: curColor,\n          });\n          canvas.setDrawingMode(true);\n          myself.vm.width = 15;\n        });\n        $btnRotation.on('click', () => {\n          cancelSelected();\n          canvas.setDrawingMode(true);\n          canvas.setFreeDrawingBrush('rotation', {});\n        });\n        $('.btn-circle').on('click', () => {\n          myself.$btnPointer.click();\n          addCircle(100, 100, 100);\n        });\n        $('.btn-rect').on('click', () => {\n          myself.$btnPointer.click();\n          addRect(100, 100, 100, 100);\n        });\n        $('.btn-line').on('click', () => {\n          myself.$btnPointer.click();\n          addLine();\n        });\n        $('.btn-triangle').on('click', () => {\n          myself.$btnPointer.click();\n          addTriangle(100, 100, 100, 100);\n        });\n        $('.btn-text').on('click', () => {\n          myself.$btnPointer.click();\n          addText(0, 0);\n        });\n\n        $btnPencil.click();\n        $('.painter-btn-remove').on('click', removeSelected);\n        myself.$btnPointer.on('click', () => {\n          canvas.setDrawingMode(false);\n        });\n        $('.painter-btn-close').on('click', () => {\n          canvas.setDrawingMode(false);\n          $('#painter-container').hide();\n        });\n        $('.painter-btn-check').on('click', () => {\n          const param = {};\n          //  todo: Deal with the End\n          //  canvas.contextContainer.imageSmoothingEnabled = false;\n          canvas.setDrawingMode(false);\n          //  result = toBase64();\n          canvas.layerManager.combineAllLayers();\n          const activeObj = this.canvas.getActiveObject();\n          const activeGroup = canvas.getActiveGroup();\n          if (activeGroup) {\n            const objectsInGroup = activeGroup.getObjects();\n            canvas.discardActiveGroup();\n            objectsInGroup.forEach((obj) => {\n              Object.assign(obj, { active: false });\n            });\n          }\n          if (activeObj) {\n            activeObj.active = false;\n          }\n          canvas.renderAll();\n          canvas.setZoom(1);\n          //  options.anchorOffsetX = result.rc.x;\n          //  options.anchorOffsetY = result.rc.y;\n\n          const data = document.createElement('canvas');\n          data.width = canvas.lowerCanvasEl.width;\n          data.height = canvas.lowerCanvasEl.height;\n          data.getContext('2d').drawImage(canvas.lowerCanvasEl, 0, 0);\n          param.img = data;\n          param.src = data.toDataURL();\n          param.rc = canvas.rotationPoint;\n          param.name = $('.painter-name').val();\n\n          if (canvas.callback) {\n            canvas.callback(param);\n          }\n\n          $('#painter-container').hide();\n        });\n      }\n\n      initEvents();\n\n      // function toBase64() {\n      //   let result;\n      //\n      //   canvas.layerManager.combineAllLayers();\n      //   let activeObj = Painter.canvas.getActiveObject();\n      //   let activeGroup = canvas.getActiveGroup();\n      //   if (activeGroup) {\n      //     let objectsInGroup = activeGroup.getObjects();\n      //     canvas.discardActiveGroup();\n      //     objectsInGroup.forEach(function (object) {\n      //       object.active = false;\n      //     });\n      //   }\n      //   if (activeObj) {\n      //     activeObj.active = false;\n      //   }\n      //   Painter.canvas.renderAll();\n      //   Painter.canvas.setZoom(1);\n      //   let data = canvas.toDataURL('png');\n      //   let img = document.createElement('img');\n      //   img.setAttribute('width', width);\n      //   img.setAttribute('height', height);\n      //   img.setAttribute('src', data);\n      //   let c = document.createElement('canvas');\n      //   c.setAttribute('width', width);\n      //   c.setAttribute('height', height);\n      //   let ctx = c.getContext('2d');\n      //   ctx.drawImage(img, 0, 0, width, height);\n      //   canvas.setZoom(1);\n      //\n      //   result = trimCanvasWithPosition(c, canvas.rotationPoint);\n      //   return result;\n      // }\n    },\n\n    /**\n     * Open image in the canvas\n     * @param img\n     * @param name\n     * @param options\n     */\n    openIn(img, name, options) {\n      const x = this.canvas.width / 2;\n      const y = this.canvas.height / 2;\n      let width = 0;\n      let height = 0;\n      if (options) {\n        width = options.width;\n        height = options.height;\n        this.canvas.rotationPoint = {\n          x: (width > this.canvas.width) ? x : options.rotationCenter.x\n            + (this.canvas.width - width) / 2,\n          y: (height > this.canvas.height) ? y : options.rotationCenter.y\n            + (this.canvas.height - height) / 2,\n        };\n        this.canvas.callback = options.callback;\n      }\n      this.canvas.clear();\n\n      $('.painter-name').val(name);\n\n      this.canvas.setHeight(this.height);\n      this.canvas.setWidth(this.width);\n      this.canvas.renderAll();\n      this.addImage(img, (this.canvas.width - width) / 2, (this.canvas.height - height) / 2);\n\n      this.$btnPencil.click();\n      $('#painter-container').show();\n    },\n\n    destroy() {\n      $('#painter-container').hide();\n    },\n  };\n})();\n"]}