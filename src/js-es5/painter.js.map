{"version":3,"sources":["../js/painter.js"],"names":[],"mappings":"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","file":"painter.js","sourcesContent":["(() => {\n  window.Painter = {\n\n    init(w, h) {\n      const $painterContent = $('.painter-content');\n      const $painterCanvas = $('#painter-canvas');\n      const $painterContainer = $('#painter-container');\n      const canvas = new fabric.Canvas('painter-canvas');\n      const myself = this;\n      let width = w;\n      let height = h;\n      let curColor = '';\n\n      this.$btnPencil = $('.btn-pencil');\n      this.$btnPointer = $('.btn-pointer');\n\n      //  todo: use relative width&height!\n      if (!width) {\n        width = $painterContent.width() - $('.painter-left-buttons').width() -\n          $('.painter-right-buttons').width() - 46;\n        height = $painterContent.height() - $('.painter-properties').height() - 26;\n      }\n      this.width = width;\n      this.height = height;\n      $painterCanvas.attr('height', height);\n      $painterCanvas.attr('width', width);\n      this.canvas = canvas;\n      canvas.enableRetinaScaling = false;\n\n      $painterContainer.css('visibility', 'visible');\n      $painterContainer.hide();\n\n      //  init vue\n\n      this.vm = new Vue({\n        el: '#painter-container',\n        data: {\n          width: 10,\n          content: '添加文字后在这里修改',\n          type: 'object',\n          color: '',\n        },\n        watch: {\n          'content'(value) {\n            const object = canvas.getActiveObject();\n            if (!object) return;\n\n            object.set('text', value).setCoords();\n            canvas.renderAll();\n          },\n          'width'(v) {\n            const object = canvas.getActiveObject();\n            let styleName = 'strokeWidth';\n            let value = v;\n            value = parseInt(value, 10);\n            if (canvas.freeDrawingBrush) {\n              canvas.freeDrawingBrush.width = value || 15;\n            }\n            if (!object) return;\n\n            if (this.type === 'text') {\n              styleName = 'fontSize';\n            }\n            if (object.setSelectionStyles && object.isEditing) {\n              const style = {};\n              style[styleName] = value;\n              object.setSelectionStyles(style);\n              object.setCoords();\n            } else {\n              object[styleName] = value;\n            }\n\n            object.setCoords();\n            canvas.renderAll();\n          },\n          'color'() {\n            curColor = this.color;\n\n            canvas.freeDrawingBrush.color = curColor;\n\n            const activeObject = canvas.getActiveObject();\n            const activeGroup = canvas.getActiveGroup();\n\n            if (activeGroup) {\n              const objectsInGroup = activeGroup.getObjects();\n              canvas.discardActiveGroup();\n              objectsInGroup.forEach((object) => {\n                if (object.stroke) {\n                  object.setStroke(curColor);\n                } else {\n                  object.setColor(curColor);\n                }\n              });\n            } else if (activeObject) {\n              if (activeObject.stroke) {\n                activeObject.setStroke(curColor);\n              } else {\n                activeObject.setColor(curColor);\n              }\n            }\n            canvas.renderAll();\n          },\n        },\n      });\n\n      function updateScope() {\n        const object = canvas.getActiveObject();\n        if (!object) return;\n\n        myself.vm.content = object.text || '';\n        if (myself.vm.content !== '') {\n          myself.vm.type = 'text';\n          myself.vm.width = object.fontSize;\n        } else {\n          myself.vm.type = 'path';\n          if (canvas.freeDrawingBrush) {\n            myself.vm.width = object.strokeWidth;\n          }\n        }\n      }\n\n      canvas.on('object:selected', updateScope);\n\n      //  init colors\n      function initColors() {\n        //  let total = 255 * 255 * 255;\n        const colors = ['e3135c', 'cd0024', 'f1521e', 'fce932', 'f5a72e', '8b5430', 'bd0add',\n          '9016e8', '4b90e0', '437715', '85d036', 'bae98a', '000000', 'ffffff'];\n        //  for (let i = 0; i < total - 100; i += total / 40) {\n        //    i = parseInt(i);\n        //    let color = i.toString(16);\n        //    while (color.length < 6) {\n        //        color = '0' + color;\n        //    }\n        //    $('.painter-colors-wrap').append(template('template-colors', {color: '#' + color}));\n        //  }\n        for (let i = 0; i < colors.length; ++i) {\n          $('.painter-colors-wrap').append(template('template-colors', { color: `#${colors[i]}` }));\n        }\n      }\n\n      initColors();\n\n      $('.painter-btn').on('click', function () {\n        if (!$(this).hasClass('active')) {\n          $(this).parent().find('.painter-btn').removeClass('active');\n          $(this).addClass('active');\n          if ($(this).hasClass('painter-colors')) {\n            canvas.freeDrawingBrush.color = $(this).attr('data-value');\n            curColor = $(this).attr('data-value');\n            myself.vm.color = curColor;\n\n            const activeObject = canvas.getActiveObject();\n            const activeGroup = canvas.getActiveGroup();\n\n            if (activeGroup) {\n              const objectsInGroup = activeGroup.getObjects();\n              canvas.discardActiveGroup();\n              objectsInGroup.forEach((object) => {\n                if (object.stroke) {\n                  object.setStroke(curColor);\n                } else {\n                  activeObject.setColor(curColor);\n                }\n              });\n            } else if (activeObject) {\n              if (activeObject.stroke) {\n                activeObject.setStroke(curColor);\n              } else {\n                activeObject.setColor(curColor);\n              }\n            }\n            canvas.renderAll();\n          }\n        }\n      });\n      function addLine() {\n        canvas.add(new fabric.Line([50, 100, 200, 200], {\n          left: Math.random() * myself.width,\n          top: Math.random() * myself.height,\n          stroke: curColor,\n          strokeWidth: myself.vm.width,\n        }));\n      }\n\n      function addRect(rectWidth, rectHeight, x, y) {\n        const rect = new fabric.Rect({\n          top: y,\n          left: x,\n          width: rectWidth,\n          height: rectHeight,\n          fill: canvas.freeDrawingBrush.color,\n        });\n        canvas.add(rect);\n      }\n\n      function addCircle(radius, x, y) {\n        canvas.add(new fabric.Circle({\n          left: x,\n          top: y,\n          fill: canvas.freeDrawingBrush.color,\n          radius: 50,\n          //  opacity: 0.8\n        }));\n      }\n\n      function addTriangle(triWidth, triHeight, x, y) {\n        canvas.add(new fabric.Triangle({\n          left: x,\n          top: y,\n          fill: canvas.freeDrawingBrush.color,\n          width: triWidth,\n          height: triHeight,\n        }));\n      }\n\n      function addImage(path, x, y) {\n        fabric.Image.fromURL(path, function (image) {\n          image.set({\n              left: x || 0,\n              top: y || 0,\n              angle: 0\n            })\n            .scale(1)\n            .setCoords();\n          Painter.canvas.add(image);\n          Painter.canvas.renderAll();\n        });\n      }\n\n      Painter.addImage = addImage;\n\n      function addText(x, y) {\n        \"use strict\";\n        let text = '点我选中文字，在画布下方可以修改文字内容和样式哦~';\n\n        let textSample = new fabric.Text(text, {\n          left: x || canvas.getWidth() / 2,\n          top: y || canvas.getHeight() / 2,\n          fontFamily: 'Microsoft YaHei',\n          angle: 0,\n          fill: canvas.freeDrawingBrush.color,\n          scaleX: 1,\n          scaleY: 1,\n          fontWeight: '',\n          originX: 'left',\n          hasRotatingPoint: true,\n          centerTransform: true\n        });\n\n        Painter.canvas.add(textSample);\n      }\n\n      function removeSelected() {\n        let activeObject = canvas.getActiveObject(),\n          activeGroup = canvas.getActiveGroup();\n\n        if (activeGroup) {\n          let objectsInGroup = activeGroup.getObjects();\n          canvas.discardActiveGroup();\n          objectsInGroup.forEach(function (object) {\n            canvas.remove(object);\n          });\n        }\n        else if (activeObject) {\n          canvas.remove(activeObject);\n        }\n      }\n\n      function cancelSelected() {\n        canvas.deactivateAll();\n        canvas.renderAll();\n        //canvas.discardActiveObject();\n      }\n\n      function initEvents() {\n        let $btnPencil = myself.$btnPencil,\n          $btnEraser = $('.btn-eraser'),\n          $btnRotation = $('.btn-rotation');\n        $('.painter-colors:first-child').click();\n        $btnPencil.on('click', function () {\n          cancelSelected();\n          canvas.setFreeDrawingBrush('pencil', {\n            width: 15,\n            color: curColor\n          });\n          canvas.setDrawingMode(true);\n          myself.vm.width = 15;\n          //canvas.freeDrawingBrush.width=10;\n          //canvas.freeDrawingBrush.color=curColor;\n        });\n        $btnEraser.on('click', function () {\n          cancelSelected();\n          canvas.setFreeDrawingBrush('eraser', {\n            width: 15,\n            color: curColor\n          });\n          canvas.setDrawingMode(true);\n          myself.vm.width = 15;\n        });\n        $btnRotation.on('click', function () {\n          cancelSelected();\n          canvas.setDrawingMode(true);\n          canvas.setFreeDrawingBrush('rotation', {});\n        });\n        $('.btn-circle').on('click', function () {\n          myself.$btnPointer.click();\n          addCircle(100, 100, 100);\n\n        });\n        $('.btn-rect').on('click', function () {\n          myself.$btnPointer.click();\n          addRect(100, 100, 100, 100);\n        });\n        $('.btn-line').on('click', function () {\n          myself.$btnPointer.click();\n          addLine();\n        });\n        $('.btn-triangle').on('click', function () {\n          myself.$btnPointer.click();\n          addTriangle(100, 100, 100, 100);\n        });\n        $('.btn-text').on('click', function () {\n          myself.$btnPointer.click();\n          addText(0, 0);\n        });\n\n        $btnPencil.click();\n        $('.painter-btn-remove').on('click', removeSelected);\n        myself.$btnPointer.on('click', function () {\n          canvas.setDrawingMode(false);\n        });\n        $('.painter-btn-close').on('click', function () {\n          canvas.setDrawingMode(false);\n          $('#painter-container').hide();\n        });\n        $('.painter-btn-check').on('click', function () {\n          let result, data, param = {};\n          //todo: Deal with the End\n          //canvas.contextContainer.imageSmoothingEnabled = false;\n          canvas.setDrawingMode(false);\n          //result = toBase64();\n          canvas.layerManager.combineAllLayers();\n          let activeObj = Painter.canvas.getActiveObject();\n          let activeGroup = canvas.getActiveGroup();\n          if (activeGroup) {\n            let objectsInGroup = activeGroup.getObjects();\n            canvas.discardActiveGroup();\n            objectsInGroup.forEach(function (object) {\n              object.active = false;\n            });\n          }\n          if (activeObj) {\n            activeObj.active = false;\n          }\n          canvas.renderAll();\n          canvas.setZoom(1);\n          //options.anchorOffsetX = result.rc.x;\n          //options.anchorOffsetY = result.rc.y;\n\n\n          data = document.createElement('canvas');\n          data.width = canvas.lowerCanvasEl.width;\n          data.height = canvas.lowerCanvasEl.height;\n          data.getContext('2d').drawImage(canvas.lowerCanvasEl, 0, 0);\n          param.img = data;\n          param.src = data.toDataURL();\n          param.rc = canvas.rotationPoint;\n          param.name = $('.painter-name').val();\n\n          if (canvas.callback) {\n            canvas.callback(param);\n          }\n\n          $('#painter-container').hide();\n        });\n      }\n\n      initEvents();\n\n      function toBase64() {\n        let result;\n\n        canvas.layerManager.combineAllLayers();\n        let activeObj = Painter.canvas.getActiveObject();\n        let activeGroup = canvas.getActiveGroup();\n        if (activeGroup) {\n          let objectsInGroup = activeGroup.getObjects();\n          canvas.discardActiveGroup();\n          objectsInGroup.forEach(function (object) {\n            object.active = false;\n          });\n        }\n        if (activeObj) {\n          activeObj.active = false;\n        }\n        Painter.canvas.renderAll();\n        Painter.canvas.setZoom(1);\n        let data = canvas.toDataURL('png');\n        let img = document.createElement('img');\n        img.setAttribute('width', width);\n        img.setAttribute('height', height);\n        img.setAttribute('src', data);\n        let c = document.createElement('canvas');\n        c.setAttribute('width', width);\n        c.setAttribute('height', height);\n        let ctx = c.getContext('2d');\n        ctx.drawImage(img, 0, 0, width, height);\n        canvas.setZoom(1);\n\n        result = trimCanvasWithPosition(c, canvas.rotationPoint);\n        return result;\n      }\n    },\n\n    /**\n     * Open image in the canvas\n     * @param img\n     * @param name\n     * @param options\n     */\n    openIn: function (img, name, options) {\n      let width = 0, height = 0,\n        x = this.canvas.width / 2,\n        y = this.canvas.height / 2;\n      if (options) {\n        width = options.width;\n        height = options.height;\n        this.canvas.rotationPoint = {\n          x: (width > this.canvas.width) ? x : options.rotationCenter.x + (this.canvas.width - width) / 2,\n          y: (height > this.canvas.height) ? y : options.rotationCenter.y + (this.canvas.height - height) / 2\n        };\n        this.canvas.callback = options.callback;\n      }\n      this.canvas.clear();\n\n      $('.painter-name').val(name);\n\n      this.canvas.setHeight(this.height);\n      this.canvas.setWidth(this.width);\n      this.canvas.renderAll();\n      this.addImage(img, (this.canvas.width - width) / 2, (this.canvas.height - height) / 2);\n\n      this.$btnPencil.click();\n      $('#painter-container').show();\n    },\n\n    destroy: function () {\n      $('#painter-container').hide();\n    }\n  };\n})();\n"]}