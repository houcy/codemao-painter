{"version":3,"sources":["../js/layer-manager.js"],"names":[],"mappings":"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","file":"layer-manager.js","sourcesContent":["/**\n * Created by GreenDou on 16/4/7.\n * LayerManager Class\n */\n\n(function(fabric){\n    \"use strict\";\n\n    if(!fabric){\n        return;\n    }\n\n    function LayerManager(parentCanvas) {\n        this.layerList = [];\n        this.currentLayer = null;\n        this.parentCanvas = parentCanvas;\n\n        if(parentCanvas){\n            this.currentLayer = new fabric.Layer(parentCanvas.lowerCanvasEl);\n            this.currentLayer.objects = parentCanvas._objects;\n            this.addLayer(this.currentLayer);\n        }\n    }\n\n    LayerManager.prototype.addLayer = function (layer){\n        var upperCanvasEl = this.parentCanvas.upperCanvasEl;\n\n        if(!layer){\n            var canvasEl = this.parentCanvas._createCanvasElement();\n            layer = new fabric.Layer(canvasEl);\n        } else if (!layer.canvasEl) {\n            layer.canvasEl = new this.parentCanvas._createCanvasElement();\n        }\n        this.layerList.push(layer);\n        layer.parent = this;\n        this.parentCanvas.wrapperEl.insertBefore(layer.canvasEl, upperCanvasEl);\n\n        this.parentCanvas._copyCanvasStyle(upperCanvasEl, layer.canvasEl);\n        this.parentCanvas._applyCanvasStyle(layer.canvasEl);\n\n        this.selectLayer(this.layerList.length - 1);\n    };\n\n    /**\n     * Remove Layer\n     * @param index\n     */\n    LayerManager.prototype.removeLayer = function (index) {\n        if(index < this.layerList.length && this.layerList.length > 1){\n            if(this.layerList[index] === this.currentLayer){\n                if(index === 0){\n                    this.selectLayer(1);\n                }else{\n                    this.selectLayer(index - 1);\n                }\n            }\n            this.parentCanvas.wrapperEl.removeChild(this.layerList[index].canvasEl);\n            this.layerList.splice(index,1);\n        }\n    };\n\n    LayerManager.prototype.upLayer = function (index) {\n        if(index!== this.layerList.length - 1){\n            this.moveLayer(index + 1, index);\n        }\n    };\n\n    /**\n     * Move Layer\n     * @param dest Index\n     * @param src  Index\n     */\n    LayerManager.prototype.moveLayer = function (dest, src) {\n        if(dest == src) {\n            return;\n        }\n        if(dest === this.layerList.length - 1){\n            this.parentCanvas.wrapperEl.insertBefore(this.layerList[src].canvasEl, this.parentCanvas.upperCanvasEl);\n        }else{\n            this.parentCanvas.wrapperEl.insertBefore(this.layerList[src].canvasEl, this.layerList[dest].canvasEl);\n        }\n        this.layerList.splice(dest, 0, this.layerList[src]);\n        if(dest > src){\n            this.layerList.splice(src,1);\n        }else{\n            this.layerList.splice(src + 1,1);\n        }\n    };\n\n    LayerManager.prototype.downLayer = function (index){\n        if(index !== 0){\n            this.moveLayer(index - 1, index);\n        }\n    };\n\n    LayerManager.prototype.showLayer = function (index) {\n        if(index< this.layerList.length){\n            this.layerList[index].canvasEl.style.display = null;\n            for(var i = 0; i < this.layerList[index].objects.length; ++i){\n                this.layerList[index].objects[i].visible = true;\n            }\n            this.layerList[index].visible = true;\n            this.parentCanvas.renderAll();\n        }\n    };\n\n    LayerManager.prototype.hideLayer = function (index) {\n        if(index < this.layerList.length){\n            this.layerList[index].canvasEl.style.display = 'none';\n            for(var i = 0; i < this.layerList[index].objects.length; ++i){\n                this.layerList[index].objects[i].visible = false;\n            }\n            this.layerList[index].visible = false;\n            this.parentCanvas.renderAll();\n            //todo: will cause error in trim-canvas for width is 0\n        }\n    };\n\n    LayerManager.prototype.toggleLayerVisible = function (index) {\n        if(this.layerList[index].visible) {\n            this.hideLayer(index);\n        } else {\n            this.showLayer(index);\n        }\n    };\n    /**\n     * Select Layer\n     * @param index\n     */\n    LayerManager.prototype.selectLayer = function (index) {\n        if(index < this.layerList.length) {\n            this.parentCanvas.deactivateAllWithDispatch();\n            this.parentCanvas.renderAll();\n            this.currentLayer = this.layerList[index];\n            this.parentCanvas.lowerCanvasEl = this.currentLayer.canvasEl;\n            this.parentCanvas.contextContainer = this.currentLayer.canvasEl.getContext('2d');\n            this.parentCanvas._objects = this.currentLayer.objects;\n        }\n    };\n\n    /**\n     *  Reset layers\n     */\n    LayerManager.prototype.clearLayers = function () {\n        this.selectLayer(0);\n        this.showLayer(0);\n        while(this.layerList.length > 1) {\n            this.removeLayer(1);\n        }\n    };\n\n    /**\n     * Make everything into one layer and kill others\n     */\n    LayerManager.prototype.combineAllLayers = function () {\n        this.selectLayer(0);\n        while(this.layerList.length > 1) {\n            this.currentLayer.objects = this.currentLayer.objects.concat(this.layerList[1].objects);\n            this.parentCanvas._objects = this.currentLayer.objects;\n            this.removeLayer(1);\n        }\n    };\n\n    /**\n     * Combine layers\n     * @param layers:Array<Number> index of layers\n     */\n    LayerManager.prototype.combineLayers = function (layers) {\n        this.selectLayer(layers[0]);\n        while(layers.length > 1) {\n            if(layers[1] < this.layerList.length){\n                this.currentLayer.objects = this.currentLayer.objects.concat(this.layerList[layers[1]].objects);\n                this.parentCanvas._objects = this.currentLayer.objects;\n                this.removeLayer(layers[1]);\n            }\n        }\n    };\n\n    fabric.LayerManager = LayerManager;\n})(fabric);\n"]}