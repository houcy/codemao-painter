{"version":3,"sources":["../js/point-brush.js"],"names":[],"mappings":";;;;;;;AAKA,CAAC,YAAY;;;;;;;AAOT,WAAO,UAAP,GAAoB,OAAO,IAAP,CAAY,WAAZ,CAAwB,OAAO,SAAP;;AAExC;;;;;;;;;AASI,oBAAY,oBAAU,MAAV,EAAkB,QAAlB,EAA4B,OAA5B,EAAqC;AAC7C,iBAAK,MAAL,GAAc,MAAd,CAD6C;AAE7C,iBAAK,QAAL,GAAgB,QAAhB,CAF6C;AAG7C,iBAAK,MAAL,CAAY,iBAAZ,GAAgC,MAAhC,CAH6C;AAI7C,iBAAK,KAAL,GAAa,CAAb,CAJ6C;;AAM7C,iBAAK,IAAI,IAAJ,IAAY,OAAjB,EAA0B;AACtB,oBAAI,QAAQ,cAAR,CAAuB,IAAvB,CAAJ,EAAkC;AAC9B,yBAAK,IAAL,IAAa,QAAQ,IAAR,CAAb,CAD8B;iBAAlC;aADJ;AAKA,iBAAK,cAAL,GAAsB,IAAI,OAAO,cAAP,CAAsB,KAAK,MAAL,CAAY,cAAZ,EAA4B,IAAtD,CAAtB,CAX6C;AAY7C,iBAAK,cAAL,CAAoB,KAApB,GAA4B,KAAK,KAAL,CAZiB;SAArC;;;;;;AAmBZ,qBAAa,qBAAU,OAAV,EAAmB;AAC5B,iBAAK,kBAAL,CAAwB,OAAxB,EAD4B;AAE5B,iBAAK,KAAL,GAAa,OAAb;;;;AAF4B,gBAM5B,CAAK,OAAL,CAAa,OAAb,EAN4B;SAAnB;;;;;;AAab,qBAAa,qBAAU,OAAV,EAAmB;;;;AAI5B,iBAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,UAAZ,CAAzB,CAJ4B;AAK5B,iBAAK,KAAL,GAAa,OAAb,CAL4B;AAM5B,iBAAK,OAAL,CAAa,OAAb,EAN4B;SAAnB;;;;;AAYb,mBAAW,qBAAY;AACnB,iBAAK,oBAAL,GADmB;SAAZ;;;;;;AAQX,4BAAoB,4BAAU,OAAV,EAAmB;;AAEnC,iBAAK,MAAL,GAFmC;AAGnC,iBAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,UAAZ,CAAzB,CAHmC;AAInC,iBAAK,cAAL,CAAoB,gBAApB,GAJmC;SAAnB;;;;;;AAWpB,gBAAQ,kBAAY;AAChB,iBAAK,eAAL,GADgB;AAEhB,iBAAK,UAAL,GAFgB;SAAZ;;AAKR,yBAAiB,2BAAY;AACzB,yBADyB;;AAEzB,gBAAI,MAAM,KAAK,MAAL,CAAY,UAAZ,CAFe;AAGzB,gBAAI,SAAJ,GAAgB,KAAK,KAAL,CAHS;AAIzB,gBAAI,OAAJ,GAAc,KAAK,aAAL,CAJW;AAKzB,gBAAI,QAAJ,GAAe,KAAK,cAAL,CALU;AAMzB,gBAAI,KAAK,eAAL,IAAwB,OAAO,YAAP,CAAoB,QAApB,CAA6B,aAA7B,CAAxB,EAAqE;AACrE,oBAAI,WAAJ,CAAgB,KAAK,eAAL,CAAhB,CADqE;aAAzE;SANa;;;;;;AAejB,iBAAS,iBAAU,OAAV,EAAmB;AACxB,gBAAI,MAAM,KAAK,MAAL,CAAY,UAAZ;gBACN,IAAI,KAAK,MAAL,CAAY,iBAAZ;gBACJ,IAAI,QAAQ,CAAR;gBACJ,IAAI,QAAQ,CAAR,CAJgB;AAKxB,gBAAI,SAAJ,GAAgB,CAAhB,CALwB;AAMxB,gBAAI,IAAJ,GANwB;AAOxB,gBAAI,SAAJ,CAAc,EAAE,CAAF,CAAd,EAAoB,EAAE,CAAF,CAApB,EAA0B,EAAE,CAAF,CAA1B,EAAgC,EAAE,CAAF,CAAhC,EAAsC,EAAE,CAAF,CAAtC,EAA4C,EAAE,CAAF,CAA5C,EAPwB;AAQxB,gBAAI,SAAJ,GAAgB,uBAAhB,CARwB;AASxB,gBAAI,WAAJ,GAAkB,iBAAlB,CATwB;AAUxB,gBAAI,SAAJ,GAVwB;AAWxB,gBAAI,GAAJ,CAAQ,CAAR,EAAW,CAAX,EAAc,EAAd,EAAkB,CAAlB,EAAqB,KAAK,EAAL,GAAU,CAAV,CAArB,CAXwB;AAYxB,gBAAI,MAAJ,GAZwB;AAaxB,gBAAI,IAAJ,GAbwB;AAcxB,gBAAI,SAAJ,GAAgB,CAAhB,CAdwB;AAexB,gBAAI,MAAJ,CAAW,CAAX,EAAc,CAAd,EAfwB;AAgBxB,gBAAI,MAAJ,CAAW,CAAX,EAAc,KAAK,MAAL,CAAY,MAAZ,CAAd,CAhBwB;AAiBxB,gBAAI,MAAJ,GAjBwB;AAkBxB,gBAAI,MAAJ,CAAW,CAAX,EAAc,CAAd,EAlBwB;AAmBxB,gBAAI,MAAJ,CAAW,KAAK,MAAL,CAAY,KAAZ,EAAmB,CAA9B,EAnBwB;AAoBxB,gBAAI,MAAJ,GApBwB;SAAnB;;;;;;;AA4BT,8BAAsB,gCAAY;AAC9B,yBAD8B;;AAE9B,gBAAI,KAAK,QAAL,EAAe;AACf,qBAAK,QAAL,CAAc,KAAK,KAAL,CAAd,CADe;aAAnB;SAFkB;;AAOtB,sBAAc,sBAAU,OAAV,EAAmB;AAC7B,iBAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,aAAZ,CAAzB,CAD6B;AAE7B,iBAAK,cAAL,CAAoB,WAApB,CAAgC,QAAQ,CAAR,EAAW,QAAQ,CAAR,CAA3C;;AAF6B,SAAnB;;AAMd,qBAAa,uBAAY;AACrB,yBADqB;;AAErB,iBAAK,OAAL,CAAa,KAAK,KAAL,CAAb,CAFqB;SAAZ;;KAvID,CAApB,CAPS;CAAZ,CAAD","file":"point-brush.js","sourcesContent":["/**\n * Created by GreenDou on 16/4/12.\n * Point Brush\n */\n\n(function () {\n\n    /**\n     * PointBrush class\n     * @class fabric.PointBrush\n     * @extends fabric.BaseBrush\n     */\n    fabric.PointBrush = fabric.util.createClass(fabric.BaseBrush,\n        /** @lends fabric.PointBrush.prototype */\n        {\n\n            /**\n             * Constructor\n             * @param {fabric.Canvas} canvas\n             * @param {function} callback\n             * @param options\n             * @return {fabric.PencilBrush} Instance of a pencil brush\n             */\n            initialize: function (canvas, callback, options) {\n                this.canvas = canvas;\n                this.callback = callback;\n                this.canvas.freeDrawingCursor = 'none';\n                this.width = 1;\n\n                for (var prop in options) {\n                    if (options.hasOwnProperty(prop)) {\n                        this[prop] = options[prop];\n                    }\n                }\n                this.cursorRenderer = new fabric.CursorRenderer(this.canvas.cursorCanvasEl, this);\n                this.cursorRenderer.width = this.width;\n            },\n\n            /**\n             * Inovoked on mouse down\n             * @param {Object} pointer\n             */\n            onMouseDown: function (pointer) {\n                this._prepareForDrawing(pointer);\n                this.point = pointer;\n                // capture coordinates immediately\n                // this allows to draw dots (when movement never occurs)\n                //this._captureDrawingPath(pointer);\n                this._render(pointer);\n            },\n\n            /**\n             * Inovoked on mouse move\n             * @param {Object} pointer\n             */\n            onMouseMove: function (pointer) {\n                //this._captureDrawingPath(pointer);\n                // redraw curve\n                // clear top canvas\n                this.canvas.clearContext(this.canvas.contextTop);\n                this.point = pointer;\n                this._render(pointer);\n            },\n\n            /**\n             * Invoked on mouse up\n             */\n            onMouseUp: function () {\n                this._finalizeAndCallback();\n            },\n\n            /**\n             * @private\n             * @param {Object} pointer Actual mouse position related to the canvas.\n             */\n            _prepareForDrawing: function (pointer) {\n\n                this._reset();\n                this.canvas.clearContext(this.canvas.contextTop);\n                this.cursorRenderer.prepareForRender();\n            },\n\n            /**\n             * Clear points array and set contextTop canvas style.\n             * @private\n             */\n            _reset: function () {\n                this._setBrushStyles();\n                this._setShadow();\n            },\n\n            _setBrushStyles: function () {\n                \"use strict\";\n                var ctx = this.canvas.contextTop;\n                ctx.lineWidth = this.width;\n                ctx.lineCap = this.strokeLineCap;\n                ctx.lineJoin = this.strokeLineJoin;\n                if (this.strokeDashArray && fabric.StaticCanvas.supports(\"setLineDash\")) {\n                    ctx.setLineDash(this.strokeDashArray);\n                }\n            },\n\n            /**\n             * Draw a smooth path on the topCanvas using quadraticCurveTo\n             * @private\n             */\n            _render: function (pointer) {\n                var ctx = this.canvas.contextTop,\n                    v = this.canvas.viewportTransform,\n                    x = pointer.x,\n                    y = pointer.y;\n                ctx.lineWidth = 1;\n                ctx.save();\n                ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n                ctx.fillStyle = 'rgba(255,255,255,0.5)';\n                ctx.strokeStyle = 'rgba(0,0,0,0.5)';\n                ctx.beginPath();\n                ctx.arc(x, y, 20, 0, Math.PI * 2);\n                ctx.stroke();\n                ctx.fill();\n                ctx.lineWidth = 1;\n                ctx.moveTo(x, 0);\n                ctx.lineTo(x, this.canvas.height);\n                ctx.stroke();\n                ctx.moveTo(0, y);\n                ctx.lineTo(this.canvas.width, y);\n                ctx.stroke();\n            },\n\n            /**\n             * On mouseup after drawing the path on contextTop canvas\n             * we use the points captured to create an new fabric path object\n             * and add it to the fabric canvas.\n             */\n            _finalizeAndCallback: function () {\n                \"use strict\";\n                if (this.callback) {\n                    this.callback(this.point);\n                }\n            },\n\n            cursorRender: function (pointer) {\n                this.canvas.clearContext(this.canvas.contextCursor);\n                this.cursorRenderer.renderPoint(pointer.x, pointer.y);\n                //this.canvas.contextTop.drawImage(this.canvas.cursorCanvasEl,0,0);\n            },\n\n            renderPoint: function () {\n                \"use strict\";\n                this._render(this.point);\n            }\n\n\n        });\n})();\n"]}