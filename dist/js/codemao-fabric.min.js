!function(){"use strict";fabric&&(fabric.BaseBrush.prototype.setOptions=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])})}(),function(){"use strict;";fabric&&(fabric.Canvas.prototype._bindEvents=function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},fabric.Canvas.prototype._onMouseOut=function(t){this.isDrawingMode&&this.clearContext(this.contextCursor)})}(),function(t){"use strict";t&&(t.Canvas.prototype.initialize=function(e,i){i||(i={}),this._initStatic(e,i),this._initInteractive(),this._createCacheCanvas(),this.layerManager=new t.LayerManager(this)},t.Canvas.prototype._initInteractive=function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._createCursorCanvas(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},t.Canvas.prototype.renderAll=function(){var e,i=this.contextContainer;return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),this.clearContext(i),this.fire("before:render"),this.clipTo&&t.util.clipContext(this,i),this._renderBackground(i),i.save(),e=this._chooseObjectsToRender(),i.transform.apply(i,this.viewportTransform),this._renderObjects(i,e),this.preserveObjectStacking||this._renderObjects(i,[this.getActiveGroup()]),i.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(i),this.clipTo&&i.restore(),this._renderOverlay(i),this.controlsAboveOverlay&&this.interactive&&this.drawControls(i),this.fire("after:render"),this},t.Canvas.prototype.clear=function(){return this.layerManager.clearLayers(),this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},t.Canvas.prototype._createCursorCanvas=function(){this.cursorCanvasEl=this._createCanvasElement(),this.wrapperEl.appendChild(this.cursorCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.cursorCanvasEl),this._applyCanvasStyle(this.cursorCanvasEl),this.cursorCanvasEl.style.pointerEvents="none",this.contextCursor=this.cursorCanvasEl.getContext("2d")},t.Canvas.prototype._onMouseMoveInDrawingMode=function(e){var i=t.util.invertTransform(this.viewportTransform),n=t.util.transformPoint(this.getPointer(e,!0),i);this._isCurrentlyDrawing&&this.freeDrawingBrush.onMouseMove(n),this.freeDrawingBrush.cursorRenderer&&this.freeDrawingBrush.cursorRender(n),this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:e});var r=this.findTarget(e);"undefined"!=typeof r&&r.fire("mousemove",{e:e,target:r})},t.Canvas.prototype.setFreeDrawingBrush=function(e,i){var n=this;switch(this.clearContext(this.contextTop),e){case"eraser":this.freeDrawingBrush&&this.freeDrawingBrush instanceof t.EraserBrush?this.freeDrawingBrush.setOptions(i):this.freeDrawingBrush=new t.EraserBrush(this,i);break;case"rotation":this.rotationPoint&&(i.point={x:this.rotationPoint.x,y:this.rotationPoint.y}),this.freeDrawingBrush&&this.freeDrawingBrush instanceof t.PointBrush?this.freeDrawingBrush.setOptions(i):this.freeDrawingBrush=new t.PointBrush(this,function(t){n.rotationPoint={x:t.x,y:t.y}},i),this.rotationPoint&&this.freeDrawingBrush.renderPoint();break;case"pencil":default:this.freeDrawingBrush&&this.freeDrawingBrush instanceof t.PencilBrush||(this.freeDrawingBrush=new t.PencilBrush(n));for(var r in i)i.hasOwnProperty(r)&&(this.freeDrawingBrush[r]=i[r])}},t.Canvas.prototype.setDrawingMode=function(t){this.freeDrawingBrush&&this.isDrawingMode!==t&&(this.clearContext(this.contextTop),t?(this.isDrawingMode=!0,this.upperCanvasEl.addEventListener("mouseout",this._onMouseOut)):(this.isDrawingMode=!1,this.upperCanvasEl.removeEventListener("mouseout",this._onMouseOut)))})}(fabric),function(){"use strict";fabric&&(fabric.PencilBrush.prototype.initialize=function(t){this.canvas=t,this._points=[],this.canvas.freeDrawingCursor="none",this.cursorRenderer=new fabric.CursorRenderer(this.canvas.cursorCanvasEl,this)},fabric.PencilBrush.prototype._prepareForDrawing=function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y),this.cursorRenderer.prepareForRender()},fabric.PencilBrush.prototype.cursorRender=function(t){this.canvas.clearContext(this.canvas.contextCursor),this.cursorRenderer.renderCircle(t.x,t.y)})}(),function(){function t(t,e,i){"use strict";this.canvas=t,this.brush=e,this.ctx=t.getContext("2d"),i?(this.width=i.width||1,this.color=i.color||"black"):(this.width=1,this.color="black")}fabric&&(t.prototype.prepareForRender=function(){"use strict";var t=this.ctx;t.lineWidth=this.width,t.strokeStyle=this.color},t.prototype.renderCircle=function(t,e){var i=this.ctx,n=this.brush.width;i.fillStyle="rgba(255,255,255,0.5)",i.lineWidth=1,i.strokeStyle="black",i.beginPath(),i.arc(t,e,n/2,0,2*Math.PI,!0),i.stroke(),i.fill()},t.prototype.renderPoint=function(t,e){var i=this.ctx;i.fillStyle="rgba(255,255,255,0.5)",i.lineWidth=1,i.strokeStyle="black";for(var n=0;20>n;n+=2)i.beginPath(),i.arc(t,e,20,2*Math.PI*n/20,2*Math.PI*(n+1)/20,!1),i.stroke();i.beginPath(),i.arc(t,e,20,0,2*Math.PI,!0),i.fill(),i.beginPath(),i.moveTo(t,e-1),i.lineTo(t,e+1),i.stroke(),i.moveTo(t-1,e),i.lineTo(t+1,e),i.stroke()},fabric.CursorRenderer=t)}(),function(){fabric.EraserBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t,e){this.canvas=t,this.backupCanvasEl=this.canvas._createCanvasElement(),this.backupContext=this.backupCanvasEl.getContext("2d"),this.canvas._copyCanvasStyle(this.canvas.upperCanvasEl,this.backupCanvasEl),this.canvas._applyCanvasStyle(this.backupCanvasEl),this.backupContext.imageSmoothingEnabled=!1,this.canvas.freeDrawingCursor="none",this._points=[],this.strokeStyle="rgb(255,255,255)",this.width=10;for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);this.cursorRenderer=new fabric.CursorRenderer(this.canvas.cursorCanvasEl,this)},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},onMouseOut:function(t){this.canvas.clearContext(this.canvas.contextCursor)},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.clearContext(this.backupCanvasEl.getContext("2d")),this.backupContext.drawImage(this.canvas.lowerCanvasEl,0,0,this.backupCanvasEl.width,this.backupCanvasEl.height),this.canvas.clearContext(this.canvas.contextContainer),this.canvas.contextTop.moveTo(e.x,e.y),this.cursorRenderer.prepareForRender()},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_setBrushStyles:function(){"use strict";var t=this.canvas.contextTop;t.strokeStyle=this.strokeStyle,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t=this.canvas.contextTop,e=this.canvas.viewportTransform,i=this._points[0],n=this._points[1];t.save(),t.drawImage(this.backupCanvasEl,0,0),t.globalCompositeOperation="destination-out",t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),2===this._points.length&&i.x===n.x&&i.y===n.y&&(i.x-=.5,n.x+=.5),t.moveTo(i.x,i.y);for(var r=1,s=this._points.length;s>r;r++){var a=i.midPointFrom(n);t.quadraticCurveTo(i.x,i.y,a.x,a.y),i=this._points[r],n=this._points[r+1]}t.lineTo(i.x,i.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=[],i=new fabric.Point(t[0].x,t[0].y),n=new fabric.Point(t[1].x,t[1].y);e.push("M ",t[0].x," ",t[0].y," ");for(var r=1,s=t.length;s>r;r++){var a=i.midPointFrom(n);e.push("Q ",i.x," ",i.y," ",a.x," ",a.y," "),i=new fabric.Point(t[r].x,t[r].y),r+1<t.length&&(n=new fabric.Point(t[r+1].x,t[r+1].y))}return e.push("L ",i.x," ",i.y," "),e},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){var t,e,i=this.canvas.contextTop,n=this,r=this.canvas.layerManager.currentLayer;i.closePath(),e=trimCanvasWithPosition(this.canvas.upperCanvasEl),t=e.canvas.toDataURL("png"),fabric.Image.fromURL(t,function(t){t.set({left:e.left,top:e.top,angle:0}).scale(1).setCoords(),Painter.canvas.setHeight(Painter.height),Painter.canvas.setWidth(Painter.width),Painter.canvas.renderAll(),Painter.canvas.add(t),n.canvas.contextTop.imageSmoothingEnabled=!1,n.canvas.clearContext(n.canvas.contextTop),r.objects.splice(0,r.objects.length,t),n.canvas.renderAll(),n.canvas.contextTop.imageSmoothingEnabled=!0})},cursorRender:function(t){this.canvas.clearContext(this.canvas.contextCursor),this.cursorRenderer.renderCircle(t.x,t.y)}})}(),function(t){"use strict";function e(e){this.layerList=[],this.currentLayer=null,this.parentCanvas=e,e&&(this.currentLayer=new t.Layer(e.lowerCanvasEl),this.currentLayer.objects=e._objects,this.addLayer(this.currentLayer))}t&&(e.prototype.addLayer=function(e){var i=this.parentCanvas.upperCanvasEl;if(e)e.canvasEl||(e.canvasEl=new this.parentCanvas._createCanvasElement);else{var n=this.parentCanvas._createCanvasElement();e=new t.Layer(n)}this.layerList.push(e),e.parent=this,this.parentCanvas.wrapperEl.insertBefore(e.canvasEl,i),this.parentCanvas._copyCanvasStyle(i,e.canvasEl),this.parentCanvas._applyCanvasStyle(e.canvasEl),this.selectLayer(this.layerList.length-1)},e.prototype.removeLayer=function(t){t<this.layerList.length&&this.layerList.length>1&&(this.layerList[t]===this.currentLayer&&(0===t?this.selectLayer(1):this.selectLayer(t-1)),this.parentCanvas.wrapperEl.removeChild(this.layerList[t].canvasEl),this.layerList.splice(t,1))},e.prototype.upLayer=function(t){t!==this.layerList.length-1&&this.moveLayer(t+1,t)},e.prototype.moveLayer=function(t,e){t!=e&&(t===this.layerList.length-1?this.parentCanvas.wrapperEl.insertBefore(this.layerList[e].canvasEl,this.parentCanvas.upperCanvasEl):this.parentCanvas.wrapperEl.insertBefore(this.layerList[e].canvasEl,this.layerList[t].canvasEl),this.layerList.splice(t,0,this.layerList[e]),t>e?this.layerList.splice(e,1):this.layerList.splice(e+1,1))},e.prototype.downLayer=function(t){0!==t&&this.moveLayer(t-1,t)},e.prototype.showLayer=function(t){if(t<this.layerList.length){this.layerList[t].canvasEl.style.display=null;for(var e=0;e<this.layerList[t].objects.length;++e)this.layerList[t].objects[e].visible=!0;this.layerList[t].visible=!0,this.parentCanvas.renderAll()}},e.prototype.hideLayer=function(t){if(t<this.layerList.length){this.layerList[t].canvasEl.style.display="none";for(var e=0;e<this.layerList[t].objects.length;++e)this.layerList[t].objects[e].visible=!1;this.layerList[t].visible=!1,this.parentCanvas.renderAll()}},e.prototype.toggleLayerVisible=function(t){this.layerList[t].visible?this.hideLayer(t):this.showLayer(t)},e.prototype.selectLayer=function(t){t<this.layerList.length&&(this.parentCanvas.deactivateAllWithDispatch(),this.parentCanvas.renderAll(),this.currentLayer=this.layerList[t],this.parentCanvas.lowerCanvasEl=this.currentLayer.canvasEl,this.parentCanvas.contextContainer=this.currentLayer.canvasEl.getContext("2d"),this.parentCanvas._objects=this.currentLayer.objects)},e.prototype.clearLayers=function(){for(this.selectLayer(0),this.showLayer(0);this.layerList.length>1;)this.removeLayer(1)},e.prototype.combineAllLayers=function(){for(this.selectLayer(0);this.layerList.length>1;)this.currentLayer.objects=this.currentLayer.objects.concat(this.layerList[1].objects),this.parentCanvas._objects=this.currentLayer.objects,this.removeLayer(1)},e.prototype.combineLayers=function(t){for(this.selectLayer(t[0]);t.length>1;)t[1]<this.layerList.length&&(this.currentLayer.objects=this.currentLayer.objects.concat(this.layerList[t[1]].objects),this.parentCanvas._objects=this.currentLayer.objects,this.removeLayer(t[1]))},t.LayerManager=e)}(fabric),function(t){"use strict";function e(t,i){this.canvasEl=t,this.name=i||"新建图层"+e.prototype.count++,this.parent=null,this.objects=[],this.visible=!0}t&&(e.prototype.count=1,e.prototype.resetCount=function(){this.prototype.count=1},t.Layer=e)}(fabric),!function(){"use strict";window.Painter={init:function(t,e){function i(){var t=g.getActiveObject();t&&(y.vm.content=t.text||"",""!==y.vm.content?(y.vm.type="text",y.vm.width=t.fontSize):(y.vm.type="path",g.freeDrawingBrush&&(y.vm.width=t.strokeWidth)))}function n(){for(var t=["e3135c","cd0024","f1521e","fce932","f5a72e","8b5430","bd0add","9016e8","4b90e0","437715","85d036","bae98a","000000","ffffff"],e=0;e<t.length;++e)$(".painter-colors-wrap").append(template("template-colors",{color:"#"+t[e]}))}function r(){g.add(new fabric.Line([50,100,200,200],{left:Math.random()*y.width,top:Math.random()*y.height,stroke:b,strokeWidth:y.vm.width}))}function s(t,e,i,n){var r=new fabric.Rect({top:n,left:i,width:t,height:e,fill:g.freeDrawingBrush.color});g.add(r)}function a(t,e,i){g.add(new fabric.Circle({left:e,top:i,fill:g.freeDrawingBrush.color,radius:50}))}function o(t,e,i,n){g.add(new fabric.Triangle({left:i,top:n,fill:g.freeDrawingBrush.color,width:t,height:e}))}function h(t,e,i,n){fabric.Image.fromURL(t,function(t){t.set({left:e||0,top:i||0,angle:0}).scale(1).setCoords(),Painter.canvas.add(t),Painter.canvas.renderAll()})}function c(t,e){var i="点我选中文字，在画布下方可以修改文字内容和样式哦~",n=new fabric.Text(i,{left:t||g.getWidth()/2,top:e||g.getHeight()/2,fontFamily:"Microsoft YaHei",angle:0,fill:g.freeDrawingBrush.color,scaleX:1,scaleY:1,fontWeight:"",originX:"left",hasRotatingPoint:!0,centerTransform:!0});Painter.canvas.add(n)}function l(){var t=g.getActiveObject(),e=g.getActiveGroup();if(e){var i=e.getObjects();g.discardActiveGroup(),i.forEach(function(t){g.remove(t)})}else t&&g.remove(t)}function u(){g.deactivateAll(),g.renderAll()}function v(){var t=y.$btnPencil,e=$(".btn-eraser"),i=$(".btn-rotation");$(".painter-colors:first-child").click(),t.on("click",function(){u(),g.setFreeDrawingBrush("pencil",{width:15,color:b}),g.setDrawingMode(!0),y.vm.width=15}),e.on("click",function(){u(),g.setFreeDrawingBrush("eraser",{width:15,color:b}),g.setDrawingMode(!0),y.vm.width=15}),i.on("click",function(){u(),g.setDrawingMode(!0),g.setFreeDrawingBrush("rotation",{})}),$(".btn-circle").on("click",function(){y.$btnPointer.click(),a(100,100,100)}),$(".btn-rect").on("click",function(){y.$btnPointer.click(),s(100,100,100,100)}),$(".btn-line").on("click",function(){y.$btnPointer.click(),r()}),$(".btn-triangle").on("click",function(){y.$btnPointer.click(),o(100,100,100,100)}),$(".btn-text").on("click",function(){y.$btnPointer.click(),c(0,0)}),t.click(),$(".painter-btn-remove").on("click",l),y.$btnPointer.on("click",function(){g.setDrawingMode(!1)}),$(".painter-btn-close").on("click",function(){g.setDrawingMode(!1),$("#painter-container").hide()}),$(".painter-btn-check").on("click",function(){var t={};g.setDrawingMode(!1),g.layerManager.combineAllLayers();var e=Painter.canvas.getActiveObject(),i=g.getActiveGroup();if(i){var n=i.getObjects();g.discardActiveGroup(),n.forEach(function(t){t.active=!1})}e&&(e.active=!1),g.renderAll(),g.setZoom(1),t.img=g.lowerCanvasEl,t.rc=g.rotationPoint,t.name=$(".painter-name").val(),g.callback&&g.callback(t),$("#painter-container").hide()})}var p=$(".painter-content"),f=$("#painter-canvas"),d=$("#painter-container"),y=this;this.$painterContent=p,this.$btnPencil=$(".btn-pencil"),this.$btnPointer=$(".btn-pointer"),t||(t=p.width()-$(".painter-left-buttons").width()-$(".painter-right-buttons").width()-46,e=p.height()-$(".painter-properties").height()-26),this.width=t,this.height=e,f.attr("height",e),f.attr("width",t);var g=new fabric.Canvas("painter-canvas");Painter.canvas=g,g.enableRetinaScaling=!1,d.css("visibility","visible"),d.hide(),this.vm=new Vue({el:"#painter-container",data:{width:10,content:"添加文字后在这里修改",type:"object",color:""},watch:{content:function(t){var e=g.getActiveObject();e&&(e.set("text",t).setCoords(),g.renderAll())},width:function(t){var e="strokeWidth";t=parseInt(t,10),g.freeDrawingBrush&&(g.freeDrawingBrush.width=t||15);var i=g.getActiveObject();if(i){if("text"===this.type&&(e="fontSize"),i.setSelectionStyles&&i.isEditing){var n={};n[e]=t,i.setSelectionStyles(n),i.setCoords()}else i[e]=t;i.setCoords(),g.renderAll()}},color:function(){b=this.color,g.freeDrawingBrush.color=b;var t=g.getActiveObject(),e=g.getActiveGroup();if(e){var i=e.getObjects();g.discardActiveGroup(),i.forEach(function(t){t.stroke?t.setStroke(b):t.setColor(b)})}else t&&(t.stroke?t.setStroke(b):t.setColor(b));g.renderAll()}}}),g.on("object:selected",i);var b="";n(),$(".painter-btn").on("click",function(){if(!$(this).hasClass("active")&&($(this).parent().find(".painter-btn").removeClass("active"),$(this).addClass("active"),$(this).hasClass("painter-colors"))){g.freeDrawingBrush.color=$(this).attr("data-value"),b=$(this).attr("data-value"),y.vm.color=b;var t=g.getActiveObject(),e=g.getActiveGroup();if(e){var i=e.getObjects();g.discardActiveGroup(),i.forEach(function(t){t.stroke?t.setStroke(b):t.setColor(b)})}else t&&(t.stroke?t.setStroke(b):t.setColor(b));g.renderAll()}}),Painter.addImage=h,v()},openIn:function(t,e,i){var n=0,r=0,s=this.canvas.width/2,a=this.canvas.height/2;i&&(n=i.width,r=i.height,this.canvas.rotationPoint={x:n>this.canvas.width?s:i.rotationCenter.x+(this.canvas.width-n)/2,y:r>this.canvas.height?a:i.rotationCenter.y+(this.canvas.height-r)/2},this.canvas.callback=i.callback),this.canvas.clear(),$(".painter-name").val(e),this.canvas.setHeight(this.height),this.canvas.setWidth(this.width),this.canvas.renderAll(),this.addImage(t,(this.canvas.width-n)/2,(this.canvas.height-r)/2),this.$btnPencil.click(),$("#painter-container").show()},destroy:function(){$("#painter-container").hide()}}}(),function(){fabric.PointBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t,e,i){this.canvas=t,this.callback=e,this.canvas.freeDrawingCursor="none",this.width=1;for(var n in i)i.hasOwnProperty(n)&&(this[n]=i[n]);this.cursorRenderer=new fabric.CursorRenderer(this.canvas.cursorCanvasEl,this),this.cursorRenderer.width=this.width},onMouseDown:function(t){this._prepareForDrawing(t),this.point=t,this._render(t)},onMouseMove:function(t){this.canvas.clearContext(this.canvas.contextTop),this.point=t,this._render(t)},onMouseUp:function(){this._finalizeAndCallback()},_prepareForDrawing:function(t){this._reset(),this.canvas.clearContext(this.canvas.contextTop),this.cursorRenderer.prepareForRender()},_reset:function(){this._setBrushStyles(),this._setShadow()},_setBrushStyles:function(){"use strict";var t=this.canvas.contextTop;t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_render:function(t){var e=this.canvas.contextTop,i=this.canvas.viewportTransform,n=t.x,r=t.y;e.lineWidth=1,e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e.fillStyle="rgba(255,255,255,0.5)",e.strokeStyle="rgba(0,0,0,0.5)",e.beginPath(),e.arc(n,r,20,0,2*Math.PI),e.stroke(),e.fill(),e.lineWidth=1,e.moveTo(n,0),e.lineTo(n,this.canvas.height),e.stroke(),e.moveTo(0,r),e.lineTo(this.canvas.width,r),e.stroke()},_finalizeAndCallback:function(){"use strict";this.callback&&this.callback(this.point)},cursorRender:function(t){this.canvas.clearContext(this.canvas.contextCursor),this.cursorRenderer.renderPoint(t.x,t.y)},renderPoint:function(){"use strict";this._render(this.point)}})}(),function(){function t(t,e){var i,n,r,s=t.getContext("2d"),a=s.getImageData(0,0,t.width,t.height),o=a.data.length,h={top:null,left:null,right:null,bottom:null};for(i=0;o>i;i+=4)0!==a.data[i+3]&&(n=i/4%t.width,r=~~(i/4/t.width),null===h.top&&(h.top=r),null===h.left?h.left=n:n<h.left&&(h.left=n),null===h.right?h.right=n:h.right<n&&(h.right=n),null===h.bottom?h.bottom=r:h.bottom<r&&(h.bottom=r));return e&&(h.top>e.y&&(h.top=e.y),h.bottom<e.y&&(h.bottom=e.y),h.left>e.x&&(h.left=e.x),h.right<e.x&&(h.right=e.x)),h.top=Math.max(h.top-10,0),h.bottom=Math.min(h.bottom+10,t.height),h.left=Math.max(h.left-10,0),h.right=Math.min(h.right+10,t.width),h}function e(e,i){"use strict";var n=document.createElement("canvas").getContext("2d"),r=t(e,i),s=r.bottom-r.top,a=r.right-r.left;return n.imageSmoothingEnabled=!1,n.canvas.width=a,n.canvas.height=s,n.drawImage(e,r.left,r.top,a,s,0,0,a,s),{canvas:n.canvas,bound:r}}window.trim_canvas=function(t){return e(t).canvas},window.trimCanvasWithPosition=function(t,i){"use strict";var n=e(t,i);return i&&(i.x=i.x-n.bound.left,i.y=i.y-n.bound.top),{canvas:n.canvas,left:n.bound.left,top:n.bound.top,rc:i}}}();